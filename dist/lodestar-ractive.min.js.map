{"version":3,"file":"lodestar-ractive.min.js","sources":["../.gobble-build/03-merge/1/lodestar-ractive.js"],"sourcesContent":["/* Lodestar-Ractive - 1.1.1. \nAuthor: Dan J Ford \nContributors: undefined \nPublished: Sun Feb 14 2016 11:43:06 GMT+0000 (GMT) */\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  global.LodeRactive = factory();\n}(this, function () { 'use strict';\n\n  var hasConsole = typeof console !== 'undefined';\n  var hasCollapsedConsole = !!console.groupCollapsed;\n  var hasHistory = !!(window.history && history.pushState);\n  var hasEventListener = !!window.addEventListener;\n\n  function fullExtend(dest, objs, deep) {\n    for (var i = 0, ii = objs.length; i < ii; i++) {\n      var obj = objs[i];\n\n      if (!isObject(obj)) return;\n\n      var objKeys = Object.keys(obj);\n\n      for (var j = 0, jj = objKeys.length; j < jj; j++) {\n        var key = objKeys[j];\n        var val = obj[key];\n\n        if (isObject(val) && deep) {\n          if (!isObject(dest[key])) dest[key] = Array.isArray(val) ? [] : {};\n          fullExtend(dest[key], [val], true);\n        } else {\n          dest[key] = val;\n        }\n      }\n    }\n\n    return dest;\n  }\n\n  /**\n   * Low extend of the object i.e. not recursive copy\n   *\n   * @param  {Object} dest, the object that will have properties copied to it\n   * @param  {Object} val, the second object with the properties to copy\n   * @return {Object} the new object with properties copied to it\n   */\n  function merge(dest, val) {\n    return fullExtend(dest, [val], false);\n  }\n\n  /**\n   * Deep extend the object i.e. recursive copy\n   *\n   * @param  {Object} dest, the object that will have properties copied to it\n   * @param  {Object} val, the second object with the properties to copy\n   * @return {Object} the new object with properties copied to it\n   */\n  function copy(dest, val) {\n    return fullExtend(dest, [val], true);\n  }\n\n  /**\n   * @param  {Object} val, the parameter to check if it is a object\n   * @return {Boolean} whether or not the parameter is an object\n   */\n  function isObject(val) {\n    return val !== null && typeof val === 'object';\n  }\n\n  var globals = {\n    DEBUG: true\n  };\n  var defaultConfig = {\n    useHistory: false,\n    basePath: '',\n    loggingLevel: 'LOW', // options are LOW or HIGH\n    usingMap: '',\n    listenerActive: false\n  };\n  /**\n   * This initialises the config for each instance with a fresh config,\n   * also adds a global variable to the window which may be used by other libs.\n   *\n   * @param  {Object} _this, this passed in from the constructore\n   * @return {Void}, nothing returned\n   */\n  function initConfig(_this) {\n\n    _this.routes = {};\n    _this.config = merge({}, defaultConfig);\n    _this.cachedPath = [];\n    window.LodeVar = window.LodeVar || {};\n  }\n\n  /**\n   * Modifies the config for an instance\n   * @param  {Object} _this, this passed in from the constructore\n   * @param  {Object} changes, the changes the user wants to make to the config.\n   * @return {Void}, nothing returned\n   */\n  function modifyConfig(_this, changes) {\n\n    if (changes) {\n\n      if (typeof changes.DEBUG !== 'undefined') globals = copy({}, { DEBUG: changes.DEBUG });delete changes.DEBUG;\n\n      if (changes.loggingLevel) changes.loggingLevel = changes.loggingLevel.toUpperCase();\n\n      _this.config = fullExtend({}, [_this.config, changes], true);\n    }\n\n    return _this.config;\n  }\n\n  var logger = {};\n\n  logger.debug = function () {\n    if (hasConsole && globals.DEBUG) console.debug.apply(console, arguments);\n  };\n\n  logger.log = function () {\n    if (hasConsole && globals.DEBUG) console.log.apply(console, arguments);\n  };\n\n  logger.warn = function () {\n    if (hasConsole && globals.DEBUG) console.warn.apply(console, arguments);\n  };\n\n  var routerIntro = ['LodestarJs-Router 1.1.1 in debug mode.'];\n  var routerMessage = '\\n\\nHello, you are running the LodestarJs Router 1.1.1 in debug mode.\\nThis will help you to identify any problems in your application.\\n\\nDEBUG mode is a global option, to disable debug mode will disable it for each\\ninstance. You can disable it when declaring a new instance. For example,\\nnew Router({DEBUG: false});\\n\\nFor documentation head to the wiki:\\n  https://github.com/lodestarjs/lodestar-router/wiki\\n\\nIf you have found any bugs, create an issue for us:\\n  https://github.com/lodestarjs/lodestar-router/issues\\n\\n';\n\n  /**\n   * The welcome function gives a message to the user letting the know\n   * some key things about the Router.\n   * @return {Void}, nothing returned\n   */\n  function welcome() {\n\n    if (hasConsole && globals.DEBUG) {\n\n      console[hasCollapsedConsole ? 'groupCollapsed' : 'log'].apply(console, routerIntro);\n\n      console.log(routerMessage);\n\n      if (hasCollapsedConsole) {\n        console.groupEnd(routerIntro);\n      }\n    }\n  }\n\n  /**\n   * Logs the route that has not been found.\n   * @param  {String} path, the child of the parent route to watch.\n   * @param  {String} originalPath, the original path\n   * @return {Void}, nothing returned\n   */\n  function notFoundLog(path, originalPath) {\n    logger.warn('Route ' + path + ' of ' + originalPath + ' not found.');\n  }\n\n  /**\n   * Clears the routes cache of no longer needed active routes\n   * @param  {String} path, The current path\n   * @return {Void}, nothing returned\n   */\n  function clearCache(path) {\n\n    var cachedPath = this.cachedPath,\n        i = cachedPath.length;\n\n    while (i--) {\n\n      var key = Object.keys(cachedPath[i])[0];\n\n      if (path.indexOf(key) === -1) {\n\n        cachedPath[i][key].active = false;\n        cachedPath.splice(i, 1);\n      }\n    }\n  }\n\n  /**\n   * Splits the dynamic part\n   * @param  {String} path, the current path to match the dynamic section\n   * @param  {Array} splitKey, the path split into dynamic segments\n   * @return {Object}, the object to map the dynamic segments into\n   */\n  function dynamicSplit(path, splitKey) {\n\n    var output = {};\n\n    while (path.length && splitKey.length) {\n\n      if (splitKey[0].indexOf(':') > -1) {\n\n        output[splitKey[0].split('/')[0].replace(/[\\/\\:]*/g, '')] = path.slice(0, path.indexOf('/') > -1 ? path.indexOf('/') : path.length);\n      }\n\n      path = path.substring(path.indexOf('/') + 1);\n      splitKey.shift();\n    }\n\n    return output;\n  }\n\n  /**\n   * The page not found function, will execute a not found function that the user sets up\n   * @param  {String} path, the current path that was not found\n   * @param  {String} originalPath, the parent of the current path that was not found\n   * @return {Void}, nothing returned\n   */\n  function pageNotFound(path, originalPath) {\n\n    if (typeof this.userNotFound !== 'undefined') this.userNotFound();\n\n    notFoundLog(path, originalPath);\n  }\n\n  function getParentPointer(pointer) {\n\n    return pointer;\n  }\n\n  /**\n   * This goes through the entire routing tree, executing the matching paths.\n   *\n   * It also makes use of caching as in that it will only need to execute the\n   * paths that are necessary.\n   *\n   * @param  {String} path, the current path that we are on\n   * @return {Void}, nothing returned\n   */\n  function resolve(path) {\n\n    if (path === '') path = '/';\n    if (!path) return;\n\n    var pointer = this.routes,\n        parent = false,\n        originalPath = path,\n        isFinal = false,\n        keyCache = '',\n        matchedParent = false,\n        currentPath = [];\n\n    while (path.length) {\n\n      var routeData = {};\n\n      // For each child of the current pointer which is some child of routes\n      for (var key in pointer) {\n\n        var dynamicKey = false;\n\n        keyCache = key;\n\n        // If contains : then it has dynamic segments\n        if (key.indexOf(':') > -1) {\n\n          var splitKey = key.split(/(?=[:])/);\n\n          // If there are more : than expected then there are multiple dynamic segments\n          if (splitKey.length >= 2) {\n\n            routeData = dynamicSplit(path, splitKey);\n            dynamicKey = key.replace(/\\:[^\\/]*/g, '[^\\\\/]*');\n          } else {\n\n            routeData[key.match(/\\:[^\\/]*/g)[0].replace(/(\\:|\\/)/g, '')] = path.match(/[^\\/]*/)[0];\n            dynamicKey = key.replace(/\\*[^\\/]*/g, '').replace(/\\:[^\\/]*/g, '[^\\\\/]*');\n          }\n        }\n\n        // If contains * then there is a wildcard segment\n        if (key.match(/\\*[a-z]+/i)) {\n\n          var temp = key.match(/.+?(?=\\*)/);\n          routeData[key.match(/\\*[a-z]+/i)[0].replace(/\\*/gi, '')] = path.replace(temp, '').replace(new RegExp(dynamicKey), '').match(/.*/)[0].split('/');\n          dynamicKey = '.*';\n        }\n\n        matchedParent = path.match('^' + (dynamicKey || key));\n\n        // Find out if we're on the final run\n        isFinal = matchedParent && path.replace(matchedParent[0], '').replace(/^\\//, '').replace(/\\/$/, '').length === 0 ? true : false;\n\n        if (path.length && matchedParent) {\n\n          // This will be used to clear the cache\n          var obj = {};\n          obj[key] = pointer[key];\n          currentPath.push(key);\n          this.cachedPath.push(obj);\n\n          // If it's not the final run and the current route is not active, execute it\n          if (!pointer[key].active && !isFinal) {\n\n            pointer[key].routeData = routeData;\n            pointer[key].active = true;\n            if (parent) pointer[key].getParent = function () {\n              return getParentPointer(parent);\n            };\n            pointer[key].controller();\n          }\n\n          // Remove current part from the path\n          path = path.replace(matchedParent[0], '').replace(/^\\//, '').replace(/\\/$/, '');\n\n          // If it is not final then re-assign the pointer\n          if (pointer[key].childRoutes && !isFinal) {\n\n            parent = pointer[key];\n            pointer = pointer[key].childRoutes;\n          } else if (!isFinal) {\n\n            pageNotFound.call(this, path, originalPath);\n            path = '';\n          }\n\n          break;\n        }\n      }\n\n      // If it's the final page, re-execute it and set to active\n      if (isFinal) {\n\n        pointer[keyCache].routeData = routeData;\n        pointer[keyCache].active = true;\n        if (parent) pointer[keyCache].getParent = function () {\n          return getParentPointer(parent);\n        };\n        pointer[keyCache].controller();\n        clearCache.call(this, currentPath);\n      } else if (!matchedParent) {\n\n        pageNotFound.call(this, path, originalPath);\n        clearCache.call(this, currentPath);\n        path = '';\n        break;\n      }\n    }\n  }\n\n  /**\n   * Used in createRoute to map a routing object to a parent in a way\n   * that the Router can understand it.\n   * @param  {String} parents, the parent path\n   * @param  {Object} routeObject, the object to add as a child\n   * @return {Void}, nothing returned\n   */\n  function traverse(parents, routeObject) {\n\n    var pointer = this.routes,\n        createPointer = {};\n\n    while (parents.length) {\n\n      for (var key in pointer) {\n\n        var matchedParent = parents.match('^' + key);\n\n        if (parents.length && matchedParent) {\n\n          parents = parents.replace(matchedParent[0], '').replace(/^\\//, '').replace(/\\/$/, '');\n\n          createPointer = pointer[key];\n          pointer = pointer[key].childRoutes || pointer[key];\n\n          break;\n        }\n      }\n    }\n\n    if (typeof createPointer.childRoutes === 'undefined') {\n      createPointer.childRoutes = {};\n    }\n\n    routeObject.path = routeObject.path.substring(routeObject.path.indexOf(']') + 1).replace(/^\\//, '').replace(/\\/$/, '');\n\n    createPointer.childRoutes[routeObject.path] = {};\n    createPointer.childRoutes[routeObject.path].controller = routeObject.controller;\n  }\n\n  function formatRoute(route) {\n\n    if (route === '') {\n      route = '/';\n    }\n\n    route = route.replace(/^(\\/?[\\#\\!\\?]+)/, '').replace(/$\\//, '');\n\n    if (this.config.basePath.length) {\n      route = route.replace(this.config.basePath, '');\n    }\n\n    return route;\n  }\n\n  /**\n   * For createRoute() grab the parent specified in the []\n   * @param  {String} url, the route to find a parent in\n   * @return {String}, the parent URL\n   */\n  function getParent$1(url) {\n    var begin = url.indexOf('[') + 1,\n        end = url.indexOf(']');\n    return url.substring(begin, end);\n  }\n\n  /**\n   * Removes the origin from the link, for those who are using absolute links..\n   * @param  {String} link, the link to have the origin removed from it.\n   * @return {String}, the link with the origin removed.\n   */\n  function removeOrigin(link) {\n\n    if (!window.location.origin) {\n      return link.replace(window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : ''), '');\n    } else {\n      return link.replace(window.location.origin, '');\n    }\n  }\n\n  /**\n   * Traverses through the parent nodes to look for an Anchor tag.\n   * Used in historyMode.\n   * @param  {HTMLElement} target, the element to begin traversing from.\n   * @return {Boolean|HTMLElement} returns false or the found element.\n   */\n  function checkParents(target) {\n\n    while (target) {\n\n      if (target instanceof HTMLAnchorElement) {\n        return target;\n      }\n\n      target = target.parentNode;\n    }\n\n    return false;\n  }\n\n  /**\n   * On click, finds the anchor tag formats the link and returns it.\n   * @param  {Event} e, the event passed through from the click event.\n   * @return {String} returns the formatted href for this link\n   */\n  function historyClick(e) {\n\n    e = window.e || e;\n\n    var target = e.target,\n        anchorLink = '',\n        targetAttr = '',\n        formattedRoute = '',\n        unformattedRoute = '';\n\n    if (target.tagName !== 'A') target = checkParents(target);\n\n    if (!target) return;\n\n    anchorLink = target.getAttribute('href');\n    targetAttr = target.getAttribute('target');\n\n    if (anchorLink.indexOf(':') > -1 && !anchorLink.match(/(?:https?):/)) return;\n\n    if (targetAttr === '_blank' || anchorLink.match(/(?:https?):/) && anchorLink.indexOf(window.location.hostname) === -1) return;\n\n    // To push to the url in case there is a base path\n    unformattedRoute = removeOrigin(anchorLink);\n    formattedRoute = formatRoute.call(this, unformattedRoute);\n\n    history.pushState(null, null, unformattedRoute);\n\n    e.preventDefault();\n\n    return formattedRoute === '' ? '/' : formattedRoute;\n  }\n\n  function listenEvent(target, e, f) {\n\n    if (hasEventListener) {\n\n      target.addEventListener(e, f, false);\n    } else {\n\n      target.attachEvent(e, f);\n    }\n  }\n\n  /**\n   * This sets up the events for 'Hashchange' and 'History' mode depending on what has been selected and what is available.\n   * @return {Void}, nothing returned\n   */\n  function listener() {\n    var _this = this;\n\n    if (this.config.listenerActive) return;\n\n    if (this.config.loggingLevel === 'HIGH') logger.debug('Listener is now active.');\n\n    var initialLink = this.config.useHistory && hasHistory ? window.location.pathname : window.location.hash;\n\n    this.config.listenerActive = true;\n\n    listenEvent(document, 'click', function (e) {\n      window.LodeVar.previousPath = formatRoute.call(_this, removeOrigin(window.location.href));\n    });\n\n    if (!this.config.useHistory || !hasHistory) {\n\n      if (this.config.loggingLevel === 'HIGH') logger.debug('Listening for hash changes.');\n\n      listenEvent(window, hasEventListener ? 'hashchange' : 'onhashchange', function () {\n        _this.resolve(formatRoute.call(_this, window.location.hash));\n      });\n    } else if (this.config.useHistory && hasHistory) {\n\n      if (this.config.loggingLevel === 'HIGH') logger.debug('Listening for clicks or popstate.');\n\n      listenEvent(document, 'click', function (e) {\n        var historyLink = historyClick.call(_this, e);\n\n        if (historyLink) {\n          _this.resolve(historyLink);\n        }\n      });\n\n      listenEvent(window, 'popstate', function () {\n        _this.resolve(formatRoute.call(_this, window.location.pathname));\n      });\n    }\n\n    // Fire the initial page load link\n    this.resolve(formatRoute.call(this, initialLink));\n  }\n\n  /**\n   * The bare bones-way of creating a routing object\n   * @param  {Object} routeObject, the route object as the Router expects it\n   * @return {Void}, nothing returned\n   */\n  function map(routeObject) {\n\n    if (this.config.usingMap === false) throw new Error('Do not use map() as well as createRoute().');\n\n    for (var key in routeObject) {\n\n      this.routes[key] = routeObject[key];\n    }\n\n    this.config.usingMap = true;\n\n    listener.call(this);\n  }\n\n  /**\n   * The nicer way of creating a route filled with validation, may take longer than map().\n   * @param  {Object} routeObject, an object that the Router will translate into an object it can understand\n   * @return {Void}, nothing returned\n   */\n  function createRoute(routeObject) {\n    var _this = this;\n\n    if (this.config.usingMap === true) throw new Error('Do not use createRoute() as well as map().');\n\n    if (!routeObject) throw new Error('No route object defined.');\n\n    if (!routeObject.path) throw new Error('Please define the route to use.');\n\n    if (!routeObject.controller || typeof routeObject.controller !== 'function') throw new Error('Please define the function that should be executed.');\n\n    var parentUrls = '';\n\n    if (routeObject.path.indexOf('[') > -1) {\n\n      parentUrls = getParent$1(routeObject.path);\n\n      traverse.call(this, parentUrls, routeObject);\n    } else {\n\n      routeObject.path = formatRoute.call(this, routeObject.path);\n      this.routes[routeObject.path] = {};\n      this.routes[routeObject.path].controller = routeObject.controller;\n    }\n\n    if (this.config.usingMap === '') {\n\n      setTimeout(function () {\n        listener.call(_this);\n      }, 0);\n    }\n\n    this.config.usingMap = false;\n  }\n\n  function Router(options) {\n\n    initConfig(this);\n\n    modifyConfig(this, options);\n\n    welcome();\n  }\n\n  Router.prototype = {\n\n    createRoute: createRoute,\n    map: map,\n    resolve: resolve,\n    notFound: function notFound(callback) {\n      this.userNotFound = callback;\n    }\n\n  };\n\n  var Promise = Promise || Ractive.Promise;\n\n  // Returns the requested element of the target doc and removes script tags\n\n  function parser(doc, options) {\n\n    var el = options.container ? options.container : 'body',\n        regExp = new RegExp('(<[\\s\\/]*script\\\\b[^>]*>)([^>]*)(<\\/script>)', 'gi');\n\n    return doc.querySelector(el).innerHTML.replace(regExp, '');\n  }\n\n  /**\n   * Load the given url and return its contents.\n   * When support for fetch increases this will probably be a lot simpler.\n   * @param  {String} options, the internal url to load page content from\n   * @return {Promise}, Will return a string of the page content\n   */\n\n  function loadPage(options) {\n\n    return new Promise(function (resolve, reject) {\n\n      var xhr = undefined;\n\n      // code for IE7+, Firefox, Chrome, Opera, Safari, SeaMonkey\n      if (window.XMLHttpRequest) {\n        xhr = new XMLHttpRequest();\n      } else {\n        xhr = new ActiveXObject('Microsoft.XMLHTTP');\n      }\n\n      xhr.onreadystatechange = function () {\n\n        var errorCodes = [404, 400, 500];\n\n        if (xhr.readyState === 4 && xhr.status === 200) {\n          resolve(parser(xhr.responseXML, options));\n        } else if (errorCodes.indexOf(xhr.status) > -1) {\n          reject({ status: this.status, statusText: xhr.statusText });\n        }\n      };\n\n      xhr.onerror = function (error) {\n        reject({ status: this.status, statusText: xhr.statusText });\n      };\n\n      xhr.open('GET', options.url);\n      xhr.responseType = 'document';\n      xhr.send();\n    });\n  }\n\n  function setup(options) {\n\n    var controllerOpts = options.controller ? options.controller : {},\n        getParent = this.getParent,\n        hasView = typeof options.view !== 'undefined';\n\n    this.controllerModel = hasView ? new Ractive(options.view) : {};\n\n    if (hasView) {\n\n      if (controllerOpts.actions) this.controllerModel.on(controllerOpts.actions);\n      if (controllerOpts.observe) this.controllerModel.observe(controllerOpts.observe);\n      if (controllerOpts.observeOnce) this.controllerModel.observeOnce(controllerOpts.observeOnce);\n    }\n\n    if (typeof this.getParent === 'function') this.controllerModel.getParent = function () {\n      return getParent().controllerModel;\n    };\n\n    this.controllerModel.on = function () {\n      throw new Error('Use the actions attribute in the route object.');\n    };\n    this.controllerModel.observe = function () {\n      new Error('Use the observe attribute in the route object.');\n    };\n    this.controllerModel.observeOnce = function () {\n      new Error('Use the observeOnce attribute in the route object.');\n    };\n\n    if (typeof controllerOpts.controller === 'function') {\n      controllerOpts.controller.call(this.controllerModel, this.routeData || {});\n    }\n  }\n\n  /**\n   * Sets up and runs the controller, if an object is given to template then it will attempt to\n   * load in a template from the given url.\n   * @param  {Object} options, the route object to set the controller up with.\n   * @return {Void}, nothing to return.\n   */\n  function setupController(options) {\n    var _this = this;\n\n    if (options.view && !options.active) {\n\n      if (!options.view.template) options.view.template = {};\n      if (typeof options.view.template === 'object' && !options.view.template.url) options.view.template.url = options.path;\n\n      if (isObject(options.view.template) && options.view.template.url) {\n\n        if (options.view.template.url === (window.LodeVar.previousPath || options.view.template.url)) {\n\n          options.view.template = parser(document.getElementsByTagName('body')[0], options.view.template);\n\n          setup.call(this, options);\n          return;\n        }\n\n        loadPage(options.view.template).then(function (template) {\n\n          options.view.template = template;\n          setup.call(_this, options);\n        });\n      } else {\n\n        setup.call(this, options);\n      }\n    } else {\n\n      setup.call(this, options);\n    }\n  }\n\n  /**\n   * Constructor for the framework. It depends on Ractive as this is a POC\n   * of using the router with Ractive.\n   * @param {Object} options, the configuration options for the framework.\n   * @returns {Void}, nothing returned\n   */\n  function LodeRactive(options) {\n\n    if (typeof Ractive === 'undefined') throw Error('Couldn\\'t find an instance of Ractive, you need to have it in order to use this framework.');\n\n    if (options && typeof options.DEBUG !== 'undefined') Ractive.DEBUG = options.DEBUG;\n\n    this.router = new Router(options);\n  }\n\n  /**\n   * Pulling in some of the functions from the lodestar Router and\n   * adding it to the frameworks prototype\n   * @type {Object}\n   */\n  LodeRactive.prototype = {\n\n    createRoute: function createRoute(options) {\n      this.router.createRoute({\n        path: options.path,\n        controller: function controller(routeData) {\n          setupController.call(this, options);\n        }\n      });\n    },\n    notFound: function notFound(options) {\n      this.router.notFound(options);\n    }\n\n  };\n\n  return LodeRactive;\n\n}));"],"names":["global","factory","exports","module","define","amd","LodeRactive","this","fullExtend","dest","objs","deep","i","ii","length","obj","isObject","objKeys","Object","keys","j","jj","key","val","Array","isArray","merge","copy","initConfig","_this","routes","config","defaultConfig","cachedPath","window","LodeVar","modifyConfig","changes","DEBUG","globals","loggingLevel","toUpperCase","welcome","hasConsole","console","hasCollapsedConsole","apply","routerIntro","log","routerMessage","groupEnd","notFoundLog","path","originalPath","logger","warn","clearCache","indexOf","active","splice","dynamicSplit","splitKey","output","split","replace","slice","substring","shift","pageNotFound","userNotFound","getParentPointer","pointer","resolve","parent","isFinal","keyCache","matchedParent","currentPath","routeData","dynamicKey","match","temp","RegExp","push","getParent","controller","childRoutes","call","traverse","parents","routeObject","createPointer","formatRoute","route","basePath","getParent$1","url","begin","end","removeOrigin","link","location","origin","protocol","hostname","port","checkParents","target","HTMLAnchorElement","parentNode","historyClick","e","anchorLink","targetAttr","formattedRoute","unformattedRoute","tagName","getAttribute","history","pushState","preventDefault","listenEvent","f","hasEventListener","addEventListener","attachEvent","listener","listenerActive","debug","initialLink","useHistory","hasHistory","pathname","hash","document","previousPath","href","historyLink","map","usingMap","Error","createRoute","parentUrls","setTimeout","Router","options","parser","doc","el","container","regExp","querySelector","innerHTML","loadPage","Promise","reject","xhr","undefined","XMLHttpRequest","ActiveXObject","onreadystatechange","errorCodes","readyState","status","responseXML","statusText","onerror","error","open","responseType","send","setup","controllerOpts","hasView","view","controllerModel","Ractive","actions","on","observe","observeOnce","setupController","template","getElementsByTagName","then","router","groupCollapsed","arguments","prototype","notFound","callback"],"mappings":"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"}