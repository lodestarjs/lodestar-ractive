!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.LodeRactive=t()}(this,function(){"use strict";function e(t,o,i){for(var r=0,a=o.length;a>r;r++){var l=o[r];if(!n(l))return;for(var c=Object.keys(l),s=0,u=c.length;u>s;s++){var h=c[s],f=l[h];n(f)&&i?(n(t[h])||(t[h]=Array.isArray(f)?[]:{}),e(t[h],[f],!0)):t[h]=f}}return t}function t(t,o){return e(t,[o],!1)}function o(t,o){return e(t,[o],!0)}function n(e){return null!==e&&"object"==typeof e}function i(e){e.routes={},e.config=t({},j),e.cachedPath=[],window.LodeVar=window.LodeVar||{}}function r(t,n){return n&&("undefined"!=typeof n.DEBUG&&(T=o({},{DEBUG:n.DEBUG})),delete n.DEBUG,n.loggingLevel&&(n.loggingLevel=n.loggingLevel.toUpperCase()),t.config=e({},[t.config,n],!0)),t.config}function a(){U&&T.DEBUG&&(console[P?"groupCollapsed":"log"].apply(console,A),console.log(F),P&&console.groupEnd(A))}function l(e,t){k.warn("Route "+e+" of "+t+" not found.")}function c(e){for(var t=this.cachedPath,o=t.length;o--;){var n=Object.keys(t[o])[0];-1===e.indexOf(n)&&(t[o][n].active=!1,t.splice(o,1))}}function s(e,t){for(var o={};e.length&&t.length;)t[0].indexOf(":")>-1&&(o[t[0].split("/")[0].replace(/[\/\:]*/g,"")]=e.slice(0,e.indexOf("/")>-1?e.indexOf("/"):e.length)),e=e.substring(e.indexOf("/")+1),t.shift();return o}function u(e,t){"undefined"!=typeof this.userNotFound&&this.userNotFound(),l(e,t)}function h(e){return e}function f(e){if(""===e&&(e="/"),e)for(var t=this.routes,o=!1,n=e,i=!1,r="",a=!1,l=[];e.length;){var f={};for(var d in t){var p=!1;if(r=d,d.indexOf(":")>-1){var g=d.split(/(?=[:])/);g.length>=2?(f=s(e,g),p=d.replace(/\:[^\/]*/g,"[^\\/]*")):(f[d.match(/\:[^\/]*/g)[0].replace(/(\:|\/)/g,"")]=e.match(/[^\/]*/)[0],p=d.replace(/\*[^\/]*/g,"").replace(/\:[^\/]*/g,"[^\\/]*"))}if(d.match(/\*[a-z]+/i)){var v=d.match(/.+?(?=\*)/);f[d.match(/\*[a-z]+/i)[0].replace(/\*/gi,"")]=e.replace(v,"").replace(new RegExp(p),"").match(/.*/)[0].split("/"),p=".*"}if(a=e.match("^"+(p||d)),i=a&&0===e.replace(a[0],"").replace(/^\//,"").replace(/\/$/,"").length?!0:!1,e.length&&a){var w={};w[d]=t[d],l.push(d),this.cachedPath.push(w),t[d].active||i||(t[d].routeData=f,t[d].active=!0,o&&(t[d].getParent=function(){return h(o)}),t[d].controller()),e=e.replace(a[0],"").replace(/^\//,"").replace(/\/$/,""),t[d].childRoutes&&!i?(o=t[d],t=t[d].childRoutes):i||(u.call(this,e,n),e="");break}}if(i)t[r].routeData=f,t[r].active=!0,o&&(t[r].getParent=function(){return h(o)}),t[r].controller(),c.call(this,l);else if(!a){u.call(this,e,n),c.call(this,l),e="";break}}}function d(e,t){for(var o=this.routes,n={};e.length;)for(var i in o){var r=e.match("^"+i);if(e.length&&r){e=e.replace(r[0],"").replace(/^\//,"").replace(/\/$/,""),n=o[i],o=o[i].childRoutes||o[i];break}}"undefined"==typeof n.childRoutes&&(n.childRoutes={}),t.path=t.path.substring(t.path.indexOf("]")+1).replace(/^\//,"").replace(/\/$/,""),n.childRoutes[t.path]={},n.childRoutes[t.path].controller=t.controller}function p(e){return""===e&&(e="/"),e=e.replace(/^(\/?[\#\!\?]+)/,"").replace(/$\//,""),this.config.basePath.length&&(e=e.replace(this.config.basePath,"")),e}function g(e){var t=e.indexOf("[")+1,o=e.indexOf("]");return e.substring(t,o)}function v(e){return window.location.origin?e.replace(window.location.origin,""):e.replace(window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),"")}function w(e){for(;e;){if(e instanceof HTMLAnchorElement)return e;e=e.parentNode}return!1}function m(e){e=window.e||e;var t=e.target,o="",n="",i="",r="";return"A"!==t.tagName&&(t=w(t)),!t||(o=t.getAttribute("href"),n=t.getAttribute("target"),o.indexOf(":")>-1&&!o.match(/(?:https?):/)||"_blank"===n||o.match(/(?:https?):/)&&-1===o.indexOf(window.location.hostname))?void 0:(r=v(o),i=p.call(this,r),history.pushState(null,null,r),e.preventDefault(),""===i?"/":i)}function b(e,t,o){B?e.addEventListener(t,o,!1):e.attachEvent(t,o)}function y(){var e=this;if(!this.config.listenerActive){"HIGH"===this.config.loggingLevel&&k.debug("Listener is now active.");var t=this.config.useHistory&&H?window.location.pathname:window.location.hash;this.config.listenerActive=!0,b(document,"click",function(t){window.LodeVar.previousPath=p.call(e,v(window.location.href))}),this.config.useHistory&&H?this.config.useHistory&&H&&("HIGH"===this.config.loggingLevel&&k.debug("Listening for clicks or popstate."),b(document,"click",function(t){var o=m.call(e,t);o&&e.resolve(o)}),b(window,"popstate",function(){e.resolve(p.call(e,window.location.pathname))})):("HIGH"===this.config.loggingLevel&&k.debug("Listening for hash changes."),b(window,B?"hashchange":"onhashchange",function(){e.resolve(p.call(e,window.location.hash))})),this.resolve(p.call(this,t))}}function E(e){if(this.config.usingMap===!1)throw new Error("Do not use map() as well as createRoute().");for(var t in e)this.routes[t]=e[t];this.config.usingMap=!0,y.call(this)}function L(e){var t=this;if(this.config.usingMap===!0)throw new Error("Do not use createRoute() as well as map().");if(!e)throw new Error("No route object defined.");if(!e.path)throw new Error("Please define the route to use.");if(!e.controller||"function"!=typeof e.controller)throw new Error("Please define the function that should be executed.");var o="";e.path.indexOf("[")>-1?(o=g(e.path),d.call(this,o,e)):(e.path=p.call(this,e.path),this.routes[e.path]={},this.routes[e.path].controller=e.controller),""===this.config.usingMap&&setTimeout(function(){y.call(t)},0),this.config.usingMap=!1}function R(e){i(this),r(this,e),a()}function x(e,t){var o=t.container?t.container:"body",n=new RegExp("(<[s/]*script\\b[^>]*>)([^>]*)(</script>)","gi");return e.querySelector(o).innerHTML.replace(n,"")}function M(e){return new N(function(t,o){var n=void 0;n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){var i=[404,400,500];4===n.readyState&&200===n.status?t(x(n.responseXML,e)):i.indexOf(n.status)>-1&&o({status:this.status,statusText:n.statusText})},n.onerror=function(e){o({status:this.status,statusText:n.statusText})},n.open("GET",e.url),n.responseType="document",n.send()})}function O(e){var t=e.controller?e.controller:{},o=this.getParent,n="undefined"!=typeof e.view;this.controllerModel=n?new Ractive(e.view):{},n&&(t.actions&&this.controllerModel.on(t.actions),t.observe&&this.controllerModel.observe(t.observe),t.observeOnce&&this.controllerModel.observeOnce(t.observeOnce)),"function"==typeof this.getParent&&(this.controllerModel.getParent=function(){return o().controllerModel}),this.controllerModel.on=function(){throw new Error("Use the actions attribute in the route object.")},this.controllerModel.observe=function(){new Error("Use the observe attribute in the route object.")},this.controllerModel.observeOnce=function(){new Error("Use the observeOnce attribute in the route object.")},"function"==typeof t.controller&&t.controller.call(this.controllerModel,this.routeData||{})}function D(e){var t=this;if(e.view&&!e.active)if(e.view.template||(e.view.template={}),"object"!=typeof e.view.template||e.view.template.t||e.view.template.v||e.view.template.url||(e.view.template.url=e.path),n(e.view.template)&&e.view.template.url){if(e.view.template.url===(window.LodeVar.previousPath||e.view.template.url))return e.view.template=x(document.getElementsByTagName("body")[0],e.view.template),void O.call(this,e);M(e.view.template).then(function(o){e.view.template=o,O.call(t,e)})}else O.call(this,e);else O.call(this,e)}function G(e){if("undefined"==typeof Ractive)throw Error("Couldn't find an instance of Ractive, you need to have it in order to use this framework.");e&&"undefined"!=typeof e.DEBUG&&(Ractive.DEBUG=e.DEBUG),this.router=new R(e)}var U="undefined"!=typeof console,P=!!console.groupCollapsed,H=!(!window.history||!history.pushState),B=!!window.addEventListener,T={DEBUG:!0},j={useHistory:!1,basePath:"",loggingLevel:"LOW",usingMap:"",listenerActive:!1},k={};k.debug=function(){U&&T.DEBUG&&console.debug.apply(console,arguments)},k.log=function(){U&&T.DEBUG&&console.log.apply(console,arguments)},k.warn=function(){U&&T.DEBUG&&console.warn.apply(console,arguments)};var A=["LodestarJs-Router 1.1.2 in debug mode."],F="\n\nHello, you are running the LodestarJs Router 1.1.2 in debug mode.\nThis will help you to identify any problems in your application.\n\nDEBUG mode is a global option, to disable debug mode will disable it for each\ninstance. You can disable it when declaring a new instance. For example,\nnew Router({DEBUG: false});\n\nFor documentation head to the wiki:\n  https://github.com/lodestarjs/lodestar-router/wiki\n\nIf you have found any bugs, create an issue for us:\n  https://github.com/lodestarjs/lodestar-router/issues\n\n";R.prototype={createRoute:L,map:E,resolve:f,notFound:function(e){this.userNotFound=e}};var N=N||Ractive.Promise;return G.prototype={createRoute:function(e){this.router.createRoute({path:e.path,controller:function(t){D.call(this,e)}})},notFound:function(e){this.router.notFound(e)}},G});
//# sourceMappingURL=lodestar-ractive.min.js.map
